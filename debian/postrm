# Post-removal script for ddns-updater package

#!/bin/bash
set -e

case "$1" in
    purge)
        # Remove user and group if they exist
        if getent passwd ddns-updater >/dev/null 2>&1; then
            deluser --system ddns-updater 2>/dev/null || true
        fi
        
        # Remove all configuration and data directories on purge
        rm -rf /etc/ddns-updater
        rm -rf /var/lib/ddns-updater
        rm -rf /var/log/ddns-updater
        rm -rf /var/backups/ddns-updater
        rm -rf /usr/share/ddns-updater
        rm -rf /usr/share/doc/ddns-updater
        
        # Remove any leftover backup files in common locations
        find /tmp -name "*ddns*" -type d -exec rm -rf {} + 2>/dev/null || true
        find /tmp -name "*ddns*.bak*" -type f -delete 2>/dev/null || true
        
        echo "DDNS Updater configuration, data, and all system files have been completely removed."
        ;;
        
    remove)
        # On remove (but not purge), only remove runtime data, keep configs
        rm -rf /var/lib/ddns-updater
        rm -rf /var/log/ddns-updater
        rm -rf /var/backups/ddns-updater
        
        # Remove temporary files
        find /tmp -name "*ddns*" -type d -exec rm -rf {} + 2>/dev/null || true
        find /tmp -name "*ddns*.bak*" -type f -delete 2>/dev/null || true
        
        # Reload systemd daemon after service files are removed
        systemctl daemon-reload || true
        
        echo "DDNS Updater has been removed. Configuration files preserved in /etc/ddns-updater"
        ;;
        
    upgrade|failed-upgrade|abort-install|abort-upgrade|disappear)
        # Reload systemd daemon after service files are removed
        systemctl daemon-reload || true
        ;;
        
    *)
        echo "postrm called with unknown argument \`$1'" >&2
        exit 1
        ;;
esac

#DEBHELPER#

exit 0